<%- include('../partials/header'); %>

<div class="container">
  <div class="row">

    <div class="col filter-sidebar">
      Filters here
    </div>

    <div class="col-10 restaurants-list">
      <div class="title">
        <!-- TODO: update the title with category & are when filters are applied -->
        <h2>Restaurants for<span class="placeholders">Category</span> in <span class="placeholders">Area</span></h2>
      </div>

      <% if (restaurants.length === 0) { %>
        <!-- TODO: add randomn suggestion here for when no results are returned -->
        <p class="error-msg">Oops, nothing is found here. How about <span class="placholders">Some category here</span>?</p>
      <% } else { %>
        <div class="list">
          <!-- TODO: check responsiveness at width 768px, too squeezy -->
          <div class="row row-cols-1 row-cols-md-3 gx-4 gy-5">
            <% restaurants.forEach(restaurant => { %>
              <div class="col">
                <a href="/restaurants/<%= restaurant.slug %>">
                  <div class="card h-100">

                    <img src="<%= restaurant.photos[0] %>" class="card-img-top pointer-on-hover" alt="<%= restaurant.slug %> image">
  
                    <div class="card-body p-3">
                      <h4 class="card-title pointer-on-hover">
                        <%= restaurant.name %>
                      </h4>
                      
                      <ul class="list-group list-group-flush">
                        <li class="list-group-item p-1 card-subtitle">
                          <!-- TODO: make neighborhood clickable, leading to index page with filter applied -->
                          <span class="neighborhood-name pointer-on-hover">
                            <%= neighborhoods.filter(neighborhood => neighborhood._id.equals(restaurant.neighborhood))[0].name %>
                          </span> 
  
                          - Open til
                          <span>
                            <% let endTime = Number(restaurant.opening_hours[day].end) %>
                            <% const session = endTime > 1200 ? "PM" : "AM" %>
                            <% let displayTime = ''%>
                            <% if (endTime > 1200) {endTime -= 1200} %>
                            <% const endTimeStr = endTime.toString().padStart(4, '0') %>
                            <% displayTime += `${endTimeStr.slice(0,2)}:${endTimeStr.slice(2,4)}` %>
                            
                            <%= `${displayTime} ${session}` %>
                          </span>
                        </li>
  
                        <li class="list-group-item p-1 card-categories">
                          <!-- TODO: make categories clickable, leading to index page with filter applied -->
                          <% for (let i = 0; i < restaurant.categories.length && i < 5; i++) { %>
                            <div class="category-tag pointer-on-hover">
                              <%= categories.filter(category => category._id.equals(restaurant.categories[i]))[0].display_name %>
                            </div>
  
                          <% } %>
                        </li>
  
                        <li class="list-group-item p-1 snippet">
                          <p class="bold">What others are saying:</a>
                          <p>
                            <%= reviews.filter(review => review.restaurant_id.equals(restaurant._id))[0].content %>
                          </p>
                        </li>
  
                        <li class="list-group-item p-1 price-reviews">
                          <div>
                            <%= restaurant.price %>
                          </div>
                          <div>
                            <% const stars = Math.round(restaurant.rating * 2)/2 %>
                            <% const imgUrl = `/img/rating-${stars}.png` %>
                            <img class="stars-rating" src="/img/rating-<%= stars %>.png" />
                          </div>
                          
                        </li>
  
                      </ul>
  
                    </div>
  
                    <div class="card-footer p-3">
                      <% if (!authUser) { %>
                        <form method="GET" action="/users/login">
                          <button class="btn restricted">Log in to pin restaurant to your board</button>
                        </form>
                      <% } else { %>
                        <form class="pin-form" method="POST" action="/">
                          <button class="btn dropdown-toggle boards-dropdown" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Pick a personal board
                          </button>
                          <ul class="dropdown-menu">
                          <!-- TODO: list users personal boards -->
                          <!-- TODO: users authentication here, if not logged in, users cannot pin -->
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                          </ul>
                        
                          <!-- TODO: update pin action route -->
                          <button class="btn btn-danger"  type="submit">Pin ðŸ“Œ</button>
                        </form>
                      <% } %>
                      
                    </div>
  
                  </div>
                </a>
                
              </div>
                
              
            <% }) %>
          </div>
        </div>
      <% } %>
      
    </div>

  </div>

</div>


<%- include('../partials/footer'); %>